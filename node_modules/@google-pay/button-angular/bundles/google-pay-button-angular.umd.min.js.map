{"version":3,"sources":["../../node_modules/tslib/tslib.es6.js","../../../lib/load-script.ts","../../../lib/button-manager.ts","../../lib/google-pay-button.component.ts","../../../lib/debounce.ts","../../lib/google-pay-button.module.ts"],"names":["__generator","thisArg","body","f","y","t","g","_","label","sent","trys","ops","next","verb","throw","return","Symbol","iterator","this","n","v","op","TypeError","call","done","value","pop","length","push","e","step","Object","create","__values","o","s","m","i","__read","r","ar","error","__spread","arguments","concat","cachedScripts","loadScript","src","existing","promise","Promise","resolve","reject","script","document","createElement","async","onScriptLoad","onScriptError","removeEventListener","remove","Error","addEventListener","appendChild","ButtonManager","options","_this","handleClick","__awaiter$1","config","request","createLoadPaymentDataRequest","client","loadPaymentData","result","_c","onLoadPaymentData","statusCode","onCancel","err_1","onError","console","prototype","getElement","element","isGooglePayLoaded","window","global","_b","_a","google","payments","api","PaymentsClient","mount","appendStyles","updateElement","unmount","undefined","configure","newConfig","oldInvalidationValues","isClientInvalidated","getInvalidationValues","createClientOptions","clientConfig","environment","merchantInfo","createMerchantInfo","onPaymentDataChanged","onPaymentAuthorized","paymentDataCallbacks","paymentData","createIsReadyToPayRequest","paymentRequest","apiVersion","apiVersionMinor","allowedPaymentMethods","existingPaymentMethodRequired","assign","softwareInfo","id","softwareInfoId","version","softwareInfoVersion","isMounted","isConnected","removeButton","ShadowRoot","Element","_d","Array","from","children","_e","child","tagName","buttonOptions","buttonType","buttonColor","buttonSizeMode","onClick","rootNode","getRootNode","buttonRootNode","button","createButton","setClassName","className","showButton","isReadyToPay","readyToPay","paymentMethodPresent","err_2","prefetchPaymentData","err","log","split","filter","onReadyToPayChange","readyToPayResponse","isButtonVisible","classNames","name","join","removeAttribute","styleId","cssSelector","replace","getElementById","style","type","innerHTML","Document","head","some","index","merchantId","merchantName","GooglePayButtonComponent","elementRef","func","wait","timeout","manager","softwareId","softwareVersion","initializeButton","assertRequiredProperty","paymentDataChangedCallback","paymentAuthorizedCallback","readyToPayChangeCallback","dispatch","reason","cancelCallback","errorCallback","nativeElement","dispatchEvent","ErrorEvent","loadPaymentDataCallback","args","_i","clearTimeout","later","apply","setTimeout","defineProperty","ngOnInit","ngOnChanges","throwError","detail","CustomEvent","bubbles","cancelable","Directive","selector","ElementRef","Input","NgModule","declarations","imports","exports"],"mappings":"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","sourcesContent":["/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation.\r\n\r\nPermission to use, copy, modify, and/or distribute this software for any\r\npurpose with or without fee is hereby granted.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\r\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\r\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\r\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\r\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\r\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\r\nPERFORMANCE OF THIS SOFTWARE.\r\n***************************************************************************** */\r\n/* global Reflect, Promise */\r\n\r\nvar extendStatics = function(d, b) {\r\n    extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\r\n    return extendStatics(d, b);\r\n};\r\n\r\nexport function __extends(d, b) {\r\n    extendStatics(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n}\r\n\r\nexport var __assign = function() {\r\n    __assign = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    }\r\n    return __assign.apply(this, arguments);\r\n}\r\n\r\nexport function __rest(s, e) {\r\n    var t = {};\r\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n        t[p] = s[p];\r\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\r\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\r\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\r\n                t[p[i]] = s[p[i]];\r\n        }\r\n    return t;\r\n}\r\n\r\nexport function __decorate(decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n}\r\n\r\nexport function __param(paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n}\r\n\r\nexport function __metadata(metadataKey, metadataValue) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\r\n}\r\n\r\nexport function __awaiter(thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\r\n\r\nexport function __generator(thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n}\r\n\r\nexport var __createBinding = Object.create ? (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });\r\n}) : (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    o[k2] = m[k];\r\n});\r\n\r\nexport function __exportStar(m, o) {\r\n    for (var p in m) if (p !== \"default\" && !Object.prototype.hasOwnProperty.call(o, p)) __createBinding(o, m, p);\r\n}\r\n\r\nexport function __values(o) {\r\n    var s = typeof Symbol === \"function\" && Symbol.iterator, m = s && o[s], i = 0;\r\n    if (m) return m.call(o);\r\n    if (o && typeof o.length === \"number\") return {\r\n        next: function () {\r\n            if (o && i >= o.length) o = void 0;\r\n            return { value: o && o[i++], done: !o };\r\n        }\r\n    };\r\n    throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");\r\n}\r\n\r\nexport function __read(o, n) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\r\n    if (!m) return o;\r\n    var i = m.call(o), r, ar = [], e;\r\n    try {\r\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\r\n    }\r\n    catch (error) { e = { error: error }; }\r\n    finally {\r\n        try {\r\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\r\n        }\r\n        finally { if (e) throw e.error; }\r\n    }\r\n    return ar;\r\n}\r\n\r\nexport function __spread() {\r\n    for (var ar = [], i = 0; i < arguments.length; i++)\r\n        ar = ar.concat(__read(arguments[i]));\r\n    return ar;\r\n}\r\n\r\nexport function __spreadArrays() {\r\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\r\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\r\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\r\n            r[k] = a[j];\r\n    return r;\r\n};\r\n\r\nexport function __await(v) {\r\n    return this instanceof __await ? (this.v = v, this) : new __await(v);\r\n}\r\n\r\nexport function __asyncGenerator(thisArg, _arguments, generator) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var g = generator.apply(thisArg, _arguments || []), i, q = [];\r\n    return i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i;\r\n    function verb(n) { if (g[n]) i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; }\r\n    function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\r\n    function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }\r\n    function fulfill(value) { resume(\"next\", value); }\r\n    function reject(value) { resume(\"throw\", value); }\r\n    function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\r\n}\r\n\r\nexport function __asyncDelegator(o) {\r\n    var i, p;\r\n    return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\r\n    function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: n === \"return\" } : f ? f(v) : v; } : f; }\r\n}\r\n\r\nexport function __asyncValues(o) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var m = o[Symbol.asyncIterator], i;\r\n    return m ? m.call(o) : (o = typeof __values === \"function\" ? __values(o) : o[Symbol.iterator](), i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i);\r\n    function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }\r\n    function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }\r\n}\r\n\r\nexport function __makeTemplateObject(cooked, raw) {\r\n    if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\r\n    return cooked;\r\n};\r\n\r\nvar __setModuleDefault = Object.create ? (function(o, v) {\r\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\r\n}) : function(o, v) {\r\n    o[\"default\"] = v;\r\n};\r\n\r\nexport function __importStar(mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\r\n    __setModuleDefault(result, mod);\r\n    return result;\r\n}\r\n\r\nexport function __importDefault(mod) {\r\n    return (mod && mod.__esModule) ? mod : { default: mod };\r\n}\r\n\r\nexport function __classPrivateFieldGet(receiver, privateMap) {\r\n    if (!privateMap.has(receiver)) {\r\n        throw new TypeError(\"attempted to get private field on non-instance\");\r\n    }\r\n    return privateMap.get(receiver);\r\n}\r\n\r\nexport function __classPrivateFieldSet(receiver, privateMap, value) {\r\n    if (!privateMap.has(receiver)) {\r\n        throw new TypeError(\"attempted to set private field on non-instance\");\r\n    }\r\n    privateMap.set(receiver, value);\r\n    return value;\r\n}\r\n","/**\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * Keeps track scripts that have been requested by loadScript.\n */\nlet cachedScripts: Record<string, Promise<any>> = {};\n\n/**\n * Asynchronously loads a script keeping track of which scripts have already\n * requested and loaded.\n *\n * Multiple requests to the same resource will return the same promise.\n *\n * @param src Script URL to load\n */\nexport function loadScript(src: string): Promise<void> {\n  const existing = cachedScripts[src];\n  if (existing) {\n    return existing;\n  }\n\n  const promise = new Promise<void>((resolve, reject) => {\n    // Create script\n    const script = document.createElement('script');\n    script.src = src;\n    script.async = true;\n\n    // Script event listener callbacks for load and error\n    const onScriptLoad = (): void => {\n      resolve();\n    };\n\n    const onScriptError = (): void => {\n      // eslint-disable-next-line @typescript-eslint/no-use-before-define\n      cleanup();\n\n      // Remove from cachedScripts so that we can try loading again\n      delete cachedScripts[src];\n      script.remove();\n\n      reject(new Error(`Unable to load script ${src}`));\n    };\n\n    script.addEventListener('load', onScriptLoad);\n    script.addEventListener('error', onScriptError);\n\n    // Add script to document body\n    document.body.appendChild(script);\n\n    // Remove event listeners on cleanup\n    function cleanup(): void {\n      script.removeEventListener('load', onScriptLoad);\n      script.removeEventListener('error', onScriptError);\n    }\n  });\n\n  cachedScripts[src] = promise;\n\n  return promise;\n}\n\n/**\n * Clears the script cache. Used for testing purposes only.\n */\nexport function clearScriptCache(): void {\n  cachedScripts = {};\n}\n","/**\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/* eslint-disable react/no-is-mounted */\n\nimport { loadScript } from '../lib/load-script';\n\nexport interface ReadyToPayChangeResponse {\n  isButtonVisible: boolean;\n  isReadyToPay: boolean;\n  paymentMethodPresent?: boolean;\n}\n\nexport interface Config {\n  environment: google.payments.api.Environment;\n  existingPaymentMethodRequired?: boolean;\n  paymentRequest: google.payments.api.PaymentDataRequest;\n  onPaymentDataChanged?: google.payments.api.PaymentDataChangedHandler;\n  onPaymentAuthorized?: google.payments.api.PaymentAuthorizedHandler;\n  onLoadPaymentData?: (paymentData: google.payments.api.PaymentData) => void;\n  onCancel?: (reason: google.payments.api.PaymentsError) => void;\n  onError?: (error: Error) => void;\n  onReadyToPayChange?: (result: ReadyToPayChangeResponse) => void;\n  buttonColor?: google.payments.api.ButtonColor;\n  buttonType?: google.payments.api.ButtonType;\n  buttonSizeMode?: google.payments.api.ButtonSizeMode;\n}\n\ninterface ButtonManagerOptions {\n  cssSelector: string;\n  softwareInfoId: string;\n  softwareInfoVersion: string;\n}\n\n/**\n * Manages the lifecycle of the Google Pay button.\n *\n * Includes lifecycle management of the `PaymentsClient` instance,\n * `isReadyToPay`, `onClick`, `loadPaymentData`, and other callback methods.\n */\nexport class ButtonManager {\n  private client?: google.payments.api.PaymentsClient;\n  private config?: Config;\n  private element?: Element;\n  private options: ButtonManagerOptions;\n  private oldInvalidationValues?: any[];\n\n  isReadyToPay?: boolean;\n  paymentMethodPresent?: boolean;\n\n  constructor(options: ButtonManagerOptions) {\n    this.options = options;\n  }\n\n  getElement(): Node | undefined {\n    return this.element;\n  }\n\n  private isGooglePayLoaded(): boolean {\n    return 'google' in (window || global) && !!google?.payments?.api?.PaymentsClient;\n  }\n\n  async mount(element: Element): Promise<void> {\n    if (!this.isGooglePayLoaded()) {\n      await loadScript('https://pay.google.com/gp/p/js/pay.js');\n    }\n\n    this.element = element;\n    if (element) {\n      this.appendStyles();\n      if (this.config) {\n        this.updateElement();\n      }\n    }\n  }\n\n  unmount(): void {\n    this.element = undefined;\n  }\n\n  configure(newConfig: Config): void {\n    this.config = newConfig;\n    if (!this.oldInvalidationValues || this.isClientInvalidated(newConfig)) {\n      this.updateElement();\n    }\n    this.oldInvalidationValues = this.getInvalidationValues(newConfig);\n  }\n\n  /**\n   * Creates client configuration options based on button configuration\n   * options.\n   *\n   * This method would normally be private but has been made public for\n   * testing purposes.\n   *\n   * @private\n   */\n  createClientOptions(config: Config): google.payments.api.PaymentOptions {\n    const clientConfig: google.payments.api.PaymentOptions = {\n      environment: config.environment,\n      merchantInfo: this.createMerchantInfo(config),\n    };\n\n    if (config.onPaymentDataChanged || config.onPaymentAuthorized) {\n      clientConfig.paymentDataCallbacks = {};\n\n      if (config.onPaymentDataChanged) {\n        // eslint-disable-next-line @typescript-eslint/explicit-function-return-type\n        clientConfig.paymentDataCallbacks.onPaymentDataChanged = paymentData => {\n          const result = config.onPaymentDataChanged!(paymentData);\n          return result || ({} as google.payments.api.PaymentDataRequestUpdate);\n        };\n      }\n\n      if (config.onPaymentAuthorized) {\n        // eslint-disable-next-line @typescript-eslint/explicit-function-return-type\n        clientConfig.paymentDataCallbacks.onPaymentAuthorized = paymentData => {\n          const result = config.onPaymentAuthorized!(paymentData);\n          return result || ({} as google.payments.api.PaymentAuthorizationResult);\n        };\n      }\n    }\n\n    return clientConfig;\n  }\n\n  private createIsReadyToPayRequest(config: Config): google.payments.api.IsReadyToPayRequest {\n    const paymentRequest = config.paymentRequest;\n    const request: google.payments.api.IsReadyToPayRequest = {\n      apiVersion: paymentRequest.apiVersion,\n      apiVersionMinor: paymentRequest.apiVersionMinor,\n      allowedPaymentMethods: paymentRequest.allowedPaymentMethods,\n      existingPaymentMethodRequired: config.existingPaymentMethodRequired,\n    };\n\n    return request;\n  }\n\n  /**\n   * Constructs `loadPaymentData` request object based on button configuration.\n   *\n   * It infers request properties like `shippingAddressRequired`,\n   * `shippingOptionRequired`, and `billingAddressRequired` if not already set\n   * based on the presence of their associated options and parameters. It also\n   * infers `callbackIntents` based on the callback methods defined in button\n   * configuration.\n   *\n   * This method would normally be private but has been made public for\n   * testing purposes.\n   *\n   * @private\n   */\n  createLoadPaymentDataRequest(config: Config): google.payments.api.PaymentDataRequest {\n    const request = {\n      ...config.paymentRequest,\n      merchantInfo: this.createMerchantInfo(config),\n    };\n\n    // TODO: #13 re-enable inferrence if/when we agree as a team\n\n    return request;\n  }\n\n  private createMerchantInfo(config: Config): google.payments.api.MerchantInfo {\n    const merchantInfo: google.payments.api.MerchantInfo = {\n      ...config.paymentRequest.merchantInfo,\n    };\n\n    // apply softwareInfo if not set\n    if (!merchantInfo.softwareInfo) {\n      merchantInfo.softwareInfo = {\n        id: this.options.softwareInfoId,\n        version: this.options.softwareInfoVersion,\n      };\n    }\n\n    return merchantInfo;\n  }\n\n  private isMounted(): boolean {\n    return this.element != null && this.element.isConnected !== false;\n  }\n\n  private removeButton(): void {\n    if (this.element instanceof ShadowRoot || this.element instanceof Element) {\n      for (const child of Array.from(this.element.children)) {\n        if (child.tagName !== 'STYLE') {\n          child.remove();\n        }\n      }\n    }\n  }\n\n  private async updateElement(): Promise<void> {\n    if (!this.isMounted()) return;\n    const element = this.element!;\n\n    if (!this.config) {\n      throw new Error('google-pay-button: Missing configuration');\n    }\n\n    // remove existing button\n    this.removeButton();\n\n    this.client = new google.payments.api.PaymentsClient(this.createClientOptions(this.config));\n\n    const buttonOptions: google.payments.api.ButtonOptions = {\n      buttonType: this.config.buttonType,\n      buttonColor: this.config.buttonColor,\n      buttonSizeMode: this.config.buttonSizeMode,\n      onClick: this.handleClick,\n    };\n\n    const rootNode = this.element?.getRootNode();\n    if (rootNode instanceof ShadowRoot) {\n      buttonOptions.buttonRootNode = rootNode;\n    }\n\n    // pre-create button\n    const button = this.client.createButton(buttonOptions);\n\n    this.setClassName(element, [element.className, 'not-ready']);\n    element.appendChild(button);\n\n    let showButton = false;\n    let readyToPay: google.payments.api.IsReadyToPayResponse | undefined;\n\n    try {\n      readyToPay = await this.client.isReadyToPay(this.createIsReadyToPayRequest(this.config));\n      showButton =\n        (readyToPay.result && !this.config.existingPaymentMethodRequired)\n        || (readyToPay.result && readyToPay.paymentMethodPresent && this.config.existingPaymentMethodRequired)\n        || false;\n    } catch (err) {\n      console.error(err);\n    }\n\n    if (!this.isMounted()) return;\n\n    if (showButton) {\n      try {\n        this.client.prefetchPaymentData(this.createLoadPaymentDataRequest(this.config));\n      } catch (err) {\n        console.log('Error with prefetch', err);\n      }\n\n      // remove hidden className\n      this.setClassName(\n        element,\n        (element.className || '').split(' ').filter(className => className && className !== 'not-ready'),\n      );\n    }\n\n    if (this.isReadyToPay !== readyToPay?.result || this.paymentMethodPresent !== readyToPay?.paymentMethodPresent) {\n      this.isReadyToPay = !!readyToPay?.result;\n      this.paymentMethodPresent = readyToPay?.paymentMethodPresent;\n\n      if (this.config.onReadyToPayChange) {\n        const readyToPayResponse: ReadyToPayChangeResponse = {\n          isButtonVisible: showButton,\n          isReadyToPay: this.isReadyToPay,\n        };\n\n        if (this.paymentMethodPresent) {\n          readyToPayResponse.paymentMethodPresent = this.paymentMethodPresent;\n        }\n\n        this.config.onReadyToPayChange(readyToPayResponse);\n      }\n    }\n  }\n\n  private handleClick = async (): Promise<void> => {\n    const config = this.config;\n    if (!config) {\n      throw new Error('google-pay-button: Missing configuration');\n    }\n\n    const request = this.createLoadPaymentDataRequest(config);\n\n    try {\n      const result = await this.client!.loadPaymentData(request);\n\n      if (config.onLoadPaymentData) {\n        config.onLoadPaymentData(result);\n      }\n    } catch (err) {\n      if (err.statusCode === 'CANCELED') {\n        if (config.onCancel) {\n          config.onCancel(err);\n        }\n      } else if (config.onError) {\n        config.onError(err);\n      } else {\n        console.error(err);\n      }\n    }\n  };\n\n  private setClassName(element: Element, classNames: string[]): void {\n    const className = classNames.filter(name => name).join(' ');\n    if (className) {\n      element.className = className;\n    } else {\n      element.removeAttribute('class');\n    }\n  }\n\n  private appendStyles(): void {\n    if (typeof document === 'undefined') return;\n\n    const rootNode = this.element?.getRootNode() as Document | ShadowRoot | undefined;\n    const styleId = `default-google-style-${this.options.cssSelector.replace(/[^\\w-]+/g, '')}`;\n\n    // initialize styles if rendering on the client:\n    if (rootNode) {\n      if (!rootNode.getElementById?.(styleId)) {\n        const style = document.createElement('style');\n        style.id = styleId;\n        style.type = 'text/css';\n        style.innerHTML = `\n          ${this.options.cssSelector} {\n            display: inline-block;\n          }\n          ${this.options.cssSelector}.not-ready {\n            width: 0;\n            height: 0;\n            overflow: hidden;\n          }\n        `;\n\n        if (rootNode instanceof Document && rootNode.head) {\n          rootNode.head.appendChild(style);\n        } else {\n          rootNode.appendChild(style);\n        }\n      }\n    }\n  }\n\n  private isClientInvalidated(newConfig: Config): boolean {\n    if (!this.oldInvalidationValues) return true;\n\n    const newValues = this.getInvalidationValues(newConfig);\n    return newValues.some((value, index) => value !== this.oldInvalidationValues![index]);\n  }\n\n  private getInvalidationValues(config: Config): any[] {\n    return [\n      config.environment,\n      config.existingPaymentMethodRequired,\n      !!config.onPaymentDataChanged,\n      !!config.onPaymentAuthorized,\n      config.buttonColor,\n      config.buttonType,\n      config.buttonSizeMode,\n      config.paymentRequest.merchantInfo.merchantId,\n      config.paymentRequest.merchantInfo.merchantName,\n      config.paymentRequest.merchantInfo.softwareInfo?.id,\n      config.paymentRequest.merchantInfo.softwareInfo?.version,\n    ];\n  }\n}\n","/**\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { ButtonManager, Config } from '../../lib/button-manager';\nimport { Directive, ElementRef, Input, OnChanges, OnInit } from '@angular/core';\nimport { name as softwareId, version as softwareVersion } from '../package.json';\nimport { debounce } from '../../lib/debounce';\n\n@Directive({\n  selector: 'google-pay-button',\n})\nexport class GooglePayButtonComponent implements OnInit, OnChanges {\n  private manager = new ButtonManager({\n    cssSelector: 'google-pay-button',\n    softwareInfoId: softwareId,\n    softwareInfoVersion: softwareVersion,\n  });\n\n  @Input() paymentRequest!: google.payments.api.PaymentDataRequest;\n  @Input() environment!: google.payments.api.Environment;\n  @Input() existingPaymentMethodRequired!: boolean;\n  @Input() buttonColor?: google.payments.api.ButtonColor;\n  @Input() buttonType?: google.payments.api.ButtonType;\n  @Input() buttonSizeMode?: google.payments.api.ButtonSizeMode;\n  @Input() paymentDataChangedCallback?: google.payments.api.PaymentDataChangedHandler;\n  @Input() paymentAuthorizedCallback?: google.payments.api.PaymentAuthorizedHandler;\n  @Input() readyToPayChangeCallback?: (result: any) => void;\n  @Input() loadPaymentDataCallback?: (paymentData: google.payments.api.PaymentData) => void;\n  @Input() cancelCallback?: (reason: google.payments.api.PaymentsError) => void;\n  @Input() errorCallback?: (error: Error) => void;\n\n  constructor(private elementRef: ElementRef) {}\n\n  get isReadyToPay(): boolean | undefined {\n    return this.manager.isReadyToPay;\n  }\n\n  ngOnInit(): Promise<void> {\n    return this.manager.mount(this.elementRef.nativeElement);\n  }\n\n  ngOnChanges(): Promise<void> {\n    return this.initializeButton();\n  }\n\n  private initializeButton = debounce(() => {\n    if (!this.assertRequiredProperty('paymentRequest')) {\n      return;\n    }\n\n    if (!this.assertRequiredProperty('environment')) {\n      return;\n    }\n\n    const config: Config = {\n      paymentRequest: this.paymentRequest,\n      environment: this.environment,\n      existingPaymentMethodRequired: this.existingPaymentMethodRequired,\n      onPaymentDataChanged: this.paymentDataChangedCallback,\n      onPaymentAuthorized: this.paymentAuthorizedCallback,\n      buttonColor: this.buttonColor,\n      buttonType: this.buttonType,\n      buttonSizeMode: this.buttonSizeMode,\n      onReadyToPayChange: result => {\n        if (this.readyToPayChangeCallback) {\n          this.readyToPayChangeCallback(result);\n        }\n        this.dispatch('readytopaychange', result);\n      },\n      onCancel: reason => {\n        if (this.cancelCallback) {\n          this.cancelCallback(reason);\n        }\n        this.dispatch('cancel', reason);\n      },\n      onError: error => {\n        if (this.errorCallback) {\n          this.errorCallback?.(error);\n        }\n        this.elementRef.nativeElement.dispatchEvent(new ErrorEvent('error', { error }));\n      },\n      onLoadPaymentData: paymentData => {\n        if (this.loadPaymentDataCallback) {\n          this.loadPaymentDataCallback(paymentData);\n        }\n        this.dispatch('loadpaymentdata', paymentData);\n      },\n    };\n\n    this.manager.configure(config);\n  });\n\n  private assertRequiredProperty(name: string): boolean {\n    const value = (this as any)[name];\n    if (value === null || value === undefined) {\n      this.throwError(Error(`Required property not set: ${name}`));\n      return false;\n    }\n\n    return true;\n  }\n\n  /**\n   * Throws an error.\n   *\n   * Used for testing purposes so that the method can be spied on.\n   */\n  private throwError(error: Error): never {\n    throw error;\n  }\n\n  private dispatch<T>(type: string, detail: T): void {\n    this.elementRef.nativeElement.dispatchEvent(\n      new CustomEvent(type, {\n        bubbles: true,\n        cancelable: false,\n        detail,\n      }),\n    );\n  }\n}\n","/**\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * Returns a new function that delays invocations to the original function\n * within a specified wait period. The last invocation within this time period\n * gets invoked. All earlier invocations are ignore.\n *\n * @param func The function to invoke.\n * @param wait The time in milliseconds to wait for idle invocations.\n */\nexport function debounce<T>(func: (...params: any[]) => T, wait = 0): () => Promise<T> {\n  let timeout: number | undefined;\n\n  return function (...args: any[]): Promise<any> {\n    window.clearTimeout(timeout);\n\n    const later = function (): any {\n      timeout = undefined;\n      return func(...args);\n    };\n\n    return new Promise(resolve => {\n      timeout = window.setTimeout(() => {\n        const result = later();\n        resolve(result);\n      }, wait);\n    });\n  };\n}\n","/**\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { GooglePayButtonComponent } from './google-pay-button.component';\nimport { NgModule } from '@angular/core';\n\n@NgModule({\n  declarations: [GooglePayButtonComponent],\n  imports: [],\n  exports: [GooglePayButtonComponent],\n})\nexport class GooglePayButtonModule {}\n"]}